{{- if and .Values.sealedSecrets.enabled .Values.sealedSecrets.dockerconfigjson }}
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ .Values.image.secretName | default "registry-credentials" }}
  namespace: {{ .Values.app.namespace }}
  labels:
    app.kubernetes.io/name: {{ .Values.app.name }}
    app.kubernetes.io/instance: {{ .Values.app.name }}
spec:
  encryptedData:
    .dockerconfigjson: {{ .Values.sealedSecrets.dockerconfigjson | required "sealedSecrets.dockerconfigjson must be provided when sealedSecrets.enabled is true. Seal your secret using: kubeseal -n {{ .Values.app.namespace }} -o yaml < <(kubectl create secret docker-registry {{ .Values.image.secretName }} --docker-server={{ .Values.image.registry }} --docker-username=<user> --docker-password=<pass> --dry-run=client -o yaml)" }}
  template:
    metadata:
      name: {{ .Values.image.secretName | default "registry-credentials" }}
      namespace: {{ .Values.app.namespace }}
      labels:
        app.kubernetes.io/name: {{ .Values.app.name }}
        app.kubernetes.io/instance: {{ .Values.app.name }}
    type: "kubernetes.io/dockerconfigjson"
{{- end }}

